// notificationUtility.js

const admin = require("firebase-admin");

// Initialize Firebase Admin SDK
const serviceAccount = require("./ka-digimesswala-prod-firebase-adminsdk-36hrm-6e34eccf3b.json");
admin.initializeApp({
  credential: admin.credential.cert(serviceAccount),
});

/**
 * Function to send push notifications using FCM.
 * @param {Object} data - Notification data.
 * @param {string} data.token - Device token.
 * @param {string} data.title - Notification title.
 * @param {string} data.body - Notification body.
 * @returns {Promise<Object>} - Promise that resolves with the FCM response.
 */
async function sendNotification({ token, title, body }) {
  console.log("inise utility function");
  const message = {
    "token": token,
    notification: {
      "title": title ,
      "body" : body,      
    },
  };

  console.log("message = ", message);

  try {
    const response = await admin.messaging().send(message);
    console.log("Successfully sent message:", response);
    return { success: true, message: "Notification sent successfully" };
  } catch (error) {
    console.error("Error sending message:", error);
    //throw { success: false, message: "Error sending notification" };
  } finally {return { success: false, message: "Error sending notification" };}
}

module.exports = { sendNotification };
